<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='userstyle.css') }}">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="userstyle.css" />
    <title>Interface</title>
</head>
<body>

    <div class="head">
        <button class="navButton" onclick="navSelect()">&#9776</button> <!-- js in seperate file -->
    </div>
        <div class="row g-0">
            <div class="col no-gutters">
                <div class="leftside">
                        <div id="nav">
                            <ul>
                                <li id = "theme" onclick="mode()">black theme &#9789</li>
                                <li><a href="\login.html"> sign out </a></li> <!-- not working-->
                            </ul>
                        </div>
                        <div class="content">
                            {% for frnd in friends%}
                                <ul id="chat-list" style="list-style-type: none;">
                                    <h3><li class="chat-name" data-username="{{frnd}}">{{frnd}}</li></h3>
                                </ul>
                            {% endfor %}
                        </div>
                   </div>
            </div>

            <div class="col ">
                <div class="rightside" >
                        <form class="TA">
                        <input class="text" type="text" placeholder="Type here" id="textmessage">
                        <button class="send" onclick="sendMessage()">SEND</button>
                    </form>
      
                    <div id="chatDiv"></div>
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
                    <script type="text/javascript" charset="utf-8">
                    var socket=io.connect()
                    let username='{{user}}';
                    let current;

                    
                    // Extract the username from the clicked <li> element's data attribute and store in variable 
                        //chatfrnd

                        const items = document.querySelectorAll(".chat-name");
                        items.forEach((li) => {
                            li.addEventListener("click", () => {
                                let chatfrnd = li.getAttribute("data-username");
                                socket.emit('joinroom',{'chatfrnd':chatfrnd,'username':username});
                                socket.on('joinroom',function(current_room){
                                    current=current_room;
                                    console.log("current_room="+current);
                                });
                            });
                        });
                        


                        socket.on('message',function(data){
                                var chatDiv = document.getElementById('chatDiv');
                                var message = document.createElement('p');
                                message.textContent = data;
                                chatDiv.appendChild(message);
                                console.log("socket.on");
                        });

                        function sendMessage(){
                            event.preventDefault();
                            let mssg=document.getElementById("textmessage").value;
                            socket.emit('send_message',{'message':mssg,'room':current});
                            document.getElementById("textmessage").value="";
                            
                        }
                                  

                </script>
                </div>
            </div>
        </div>
        <script src="javascript.js"></script>

    </body>

</html>


